#ifndef H_NET
#define H_NET

#include "mongoose.h"

#define NET_REQ_GET_USERNAME 0b00010000
#define NET_REQ_LOOKUP_USERNAME 0b00010100
#define NET_REQ_CREATE_ACCOUNT 0b00100000
#define NET_REQ_REQUEST_CHALLENGE 0b00110000
#define NET_REQ_CHALLENGE_RESPONSE 0b00111000
#define NET_REQ_LOG_OUT 0b01000000
#define NET_REQ_CHANGE_USERNAME 0b01010000
#define NET_REQ_CHANGE_KEY 0b01100000
#define NET_REQ_DELETE_ACCOUNT 0b01110000
#define NET_REQ_CREATE_GAME 0b10000000
#define NET_REQ_JOIN_GAME 0b10010000
#define NET_REQ_LEAVE_GAME 0b11110000

#define NET_RES_OK_USERNAME 0b00001000
#define NET_RES_OK_ACCOUNT_ID 0b00001010
#define NET_RES_OK_LOG_IN_CHALLENGE 0b00011000
#define NET_RES_OK_CONFIRMATION 0b00100000
#define NET_RES_OK_ACCOUNT 0b01000000
#define NET_RES_OK_GAME_TOKEN 0b01100000
#define NET_RES_ERR_SERVER 0b10000000
#define NET_RES_ERR_NOT_LOGGED_IN 0b11000000
#define NET_RES_ERR_LOGGED_IN 0b11000010
#define NET_RES_ERR_NOT_GAME_HOST 0b11000100
#define NET_RES_ERR_NO_CHALLENGE_REQUEST 0b11001000
#define NET_RES_ERR_LOG_IN_FAILED 0b11001010
#define NET_RES_ERR_INVALID_PUBLIC_KEY 0b11001011
#define NET_RES_ERR_UNKNOWN_ID 0b11001100
#define NET_RES_ERR_INVALID_USERNAME 0b11001101
#define NET_RES_ERR_UNKNOWN_USERNAME 0b11001110
#define NET_RES_ERR_USERNAME_IN_USE 0b11001111
#define NET_RES_ERR_INVALID_GAME_ID 0b11010000
#define NET_RES_ERR_UNKNOWN_GAME_ID 0b11010010
#define NET_RES_ERR_NOT_IN_GAME 0b11010100
#define NET_RES_ERR_IN_GAME 0b11010110
#define NET_RES_ERR_MALFORMED_OPCODE 0b11100000
#define NET_RES_ERR_MALFORMED_DATA 0b11101000
#define NET_RES_ERR_MALFORMED_BASE64 0b11110000


struct NetSessionResponse {
	void* data;
	char finished;
};

struct NetSession {
	struct mg_mgr eventManager;
	struct mg_connection* connection;
	struct NetSessionResponse resp;
};

struct NetSession* netConnect(char* url);

void netDispose(struct NetSession* session);

void* netRequest(struct NetSession* session, unsigned char operation, void* data);

void netCreateAccount(struct NetSession* session, char* username);

void netLogin(struct NetSession* session);

#endif
